import{r as o,a as q,u as K,j as e}from"./index-Cmzhr2PI.js";import{F as Q}from"./FileUpload-C0_H3aEp.js";import{D as V,E as M,a as B,u as k,w as H}from"./jspdf.plugin.autotable-D5Z2eyjb.js";import{f as w}from"./currency-DGtur7pf.js";const X=()=>{const[c,f]=o.useState([]),[j,N]=o.useState(!0),[u,S]=o.useState(""),[y,_]=o.useState("all"),[C,p]=o.useState(!1),[d,x]=o.useState({name:"",category:"",stock:0,reorderLevel:0,unitPrice:0}),[i,m]=o.useState(null),{user:b}=q();K();const v=(b==null?void 0:b.role)||"admin";o.useEffect(()=>{h()},[]);const h=async()=>{try{const t=await fetch("/api/inventory",{credentials:"include"});if(t.ok){const a=await t.json();f(a.products||[])}}catch(t){console.error("Failed to load products:",t)}finally{N(!1)}},P=async t=>{const a=new FormData;a.append("file",t);try{const l=await fetch("/api/inventory/upload-csv",{method:"POST",credentials:"include",body:a}),r=await l.json();l.ok?(alert(`${r.message}

Created: ${r.created} products`),await h()):alert(`Upload failed: ${r.message}`)}catch{alert("Upload failed: Network error")}},L=async()=>{try{(await fetch("/api/inventory/add-product",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)})).ok?(alert("Product added successfully!"),p(!1),x({name:"",category:"",stock:0,reorderLevel:0,unitPrice:0}),await h()):alert("Failed to add product")}catch{alert("Failed to add product")}},U=(t,a)=>{m({productId:t,value:(a==null?void 0:a.toString())||"0"})},F=async t=>{if(!i)return;const a=parseFloat(i.value);if(isNaN(a)||a<0){alert("Please enter a valid price");return}try{(await fetch(`/api/inventory/${t}/price`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({unitPrice:a})})).ok?(m(null),await h()):alert("Failed to update price")}catch{alert("Failed to update price")}},D=()=>{m(null)},I=()=>{const t=["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"],a=g.map(n=>[n.product_name,n.sku,n.category||"Uncategorized",n.unit_price||0,n.quantity_available||0,n.reorder_level||0,n.is_low_stock?"Low Stock":"In Stock"]),l=[t,...a].map(n=>n.map(O=>`"${O}"`).join(",")).join(`
`),r=new Blob([l],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),z=URL.createObjectURL(r);s.setAttribute("href",z),s.setAttribute("download",`inventory_${new Date().toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)},T=()=>{const t=["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"],a=g.map(s=>[s.product_name,s.sku,s.category||"Uncategorized",s.unit_price||0,s.quantity_available||0,s.reorder_level||0,s.is_low_stock?"Low Stock":"In Stock"]),l=k.aoa_to_sheet([t,...a]),r=k.book_new();k.book_append_sheet(r,l,"Inventory"),H(r,`inventory_${new Date().toISOString().split("T")[0]}.xlsx`)},A=()=>{const t=new M;t.setFontSize(16),t.text("Inventory Report",14,15),t.setFontSize(10),t.text(`Generated on: ${new Date().toLocaleDateString()}`,14,25);const a=[["Product Name","SKU","Category","Unit Price","Stock Quantity","Reorder Level","Status"]],l=g.map(r=>[r.product_name,r.sku,r.category||"Uncategorized",r.unit_price?w(r.unit_price):"₹0.00",r.quantity_available||0,r.reorder_level||0,r.is_low_stock?"Low Stock":"In Stock"]);B(t,{head:a,body:l,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),t.save(`inventory_${new Date().toISOString().split("T")[0]}.pdf`)},g=c.filter(t=>{const a=t.product_name.toLowerCase().includes(u.toLowerCase())||t.sku.toLowerCase().includes(u.toLowerCase()),l=y==="all"||t.category===y;return a&&l}),E=c.reduce((t,a)=>t+(a.quantity_available||0),0),R=c.filter(t=>t.is_low_stock).length,$=[...new Set(c.map(t=>t.category).filter(Boolean))];return j?e.jsxs("div",{className:"p-6 bg-gray-100 dark:bg-gray-900 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-6",children:"Inventory"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Loading inventory..."})})]}):e.jsxs("div",{className:"p-6 bg-light-pink dark:bg-gray-900 min-h-screen",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-6",children:"Inventory"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Total Products"}),e.jsx("p",{className:"text-4xl font-bold text-indigo-600",children:c.length})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Total Stock"}),e.jsx("p",{className:"text-4xl font-bold text-green-600",children:E})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-5 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Low Stock Items"}),e.jsx("p",{className:"text-4xl font-bold text-red-600",children:R})]})]}),v==="admin"&&e.jsxs("div",{className:"mb-6",children:[e.jsx(Q,{onFileUpload:P}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"CSV Upload Format:"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mb-2",children:"Your CSV file should include these columns:"}),e.jsx("div",{className:"text-xs font-mono bg-white dark:bg-gray-800 p-2 rounded border overflow-x-auto",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"product_name, category, stock_quantity, reorder_level, unit_price"})}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:[e.jsx("strong",{children:"Example:"})," iPhone 15, Electronics, 50, 10, 25000.00"]}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:[e.jsx("strong",{children:"Note:"})," SKU will be auto-generated for each product"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("button",{onClick:()=>p(!0),className:"p-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors w-full",children:"Add Product Manually"}),e.jsx(V,{onDownloadCSV:I,onDownloadExcel:T,onDownloadPDF:A})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Search products...",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:u,onChange:t=>S(t.target.value)}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:y,onChange:t=>_(t.target.value),children:[e.jsx("option",{value:"all",children:"All Categories"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"bg-light-pink-100 dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Product Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Reorder Level"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:["No products found. ",c.length===0?"Add some products to get started.":"Try adjusting your search or filters."]})}):g.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.product_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.sku}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.category||"Uncategorized"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:v==="admin"?(i==null?void 0:i.productId)===t.product_id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:i.value,onChange:a=>m({...i,value:a.target.value}),className:"w-20 px-2 py-1 text-xs border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white",autoFocus:!0}),e.jsx("button",{onClick:()=>F(t.product_id),className:"text-green-600 hover:text-green-800 text-xs",children:"✓"}),e.jsx("button",{onClick:D,className:"text-red-600 hover:text-red-800 text-xs",children:"✕"})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:t.unit_price&&t.unit_price>0?w(t.unit_price):e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})}),e.jsx("button",{onClick:()=>U(t.product_id,t.unit_price||0),className:"text-blue-600 hover:text-blue-800 text-xs ml-2",title:"Edit price",children:"✏️"})]}):e.jsx("span",{children:t.unit_price&&t.unit_price>0?w(t.unit_price):e.jsx("span",{className:"text-gray-400 italic",children:"Not set"})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.quantity_available||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.reorder_level||0}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.is_low_stock?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:t.is_low_stock?"Low Stock":"In Stock"})})]},t.product_id))})]})})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Product"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.name,onChange:t=>x({...d,name:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Category",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.category,onChange:t=>x({...d,category:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Stock Quantity",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.stock,onChange:t=>x({...d,stock:parseInt(t.target.value)||0})}),e.jsx("input",{type:"number",placeholder:"Unit Price",step:"0.01",min:"0",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.unitPrice,onChange:t=>x({...d,unitPrice:parseFloat(t.target.value)||0})}),e.jsx("input",{type:"number",placeholder:"Reorder Level",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.reorderLevel,onChange:t=>x({...d,reorderLevel:parseInt(t.target.value)||0})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:!d.name,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Add Product"})]})]})})]})};export{X as default};
