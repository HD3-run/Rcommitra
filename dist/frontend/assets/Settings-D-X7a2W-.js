import{a as M,u as O,r as l,j as e}from"./index-Cmzhr2PI.js";function J(){const{user:x}=M();O();const c=x==null?void 0:x.role,[m,b]=l.useState({name:"",email:"",phone:""}),[f,w]=l.useState(""),[u,k]=l.useState(""),[j,N]=l.useState(""),[v,t]=l.useState(""),[n,o]=l.useState(!1),[U,F]=l.useState([]),[P,h]=l.useState(!1),[C,T]=l.useState(!1),[d,i]=l.useState({username:"",email:"",phone:"",role:"",password:""});l.useEffect(()=>{(async()=>{try{const r=await fetch("/api/profile",{credentials:"include"});if(r.ok){const s=await r.json();b({name:s.username||"",email:s.email||"",phone:s.phone||""})}}catch{t("Failed to load profile data")}})(),c==="admin"&&g()},[c]);const g=async()=>{try{const a=await fetch("/api/users",{credentials:"include"});if(a.ok){const r=await a.json();F(r.users||[])}}catch{t("Failed to load users")}},E=async a=>{a.preventDefault(),o(!0);try{const r=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});if(r.ok)t("User added successfully!"),i({username:"",email:"",phone:"",role:"",password:""}),h(!1),g();else{const s=await r.json();t(s.message||"Failed to add user")}}catch{t("Failed to add user")}finally{o(!1),setTimeout(()=>t(""),3e3)}},S=async(a,r)=>{o(!0);try{const s=await fetch(`/api/users/${a}/role`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:r})});if(s.ok)t("Role updated successfully!"),g();else{const y=await s.json();t(y.message||"Failed to update role")}}catch{t("Failed to update role")}finally{o(!1),setTimeout(()=>t(""),3e3)}},R=async a=>{if(confirm("Are you sure you want to remove this user?")){o(!0);try{const r=await fetch(`/api/users/${a}`,{method:"DELETE",credentials:"include"});if(r.ok)t("User removed successfully!"),g();else{const s=await r.json();t(s.message||"Failed to remove user")}}catch{t("Failed to remove user")}finally{o(!1),setTimeout(()=>t(""),3e3)}}},p=a=>{const{name:r,value:s}=a.target;b(y=>({...y,[r]:s}))},A=async a=>{a.preventDefault(),o(!0);try{const r=await fetch("/api/profile",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(m)});if(r.ok)t("Profile updated successfully!");else{const s=await r.json();t(s.message||"Failed to update profile")}}catch{t("Failed to update profile")}finally{o(!1),setTimeout(()=>t(""),3e3)}},D=async a=>{if(a.preventDefault(),u!==j){t("New passwords do not match.");return}o(!0);try{const r=await fetch("/api/profile/password",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({currentPassword:f,newPassword:u})});if(r.ok)t("Password changed successfully!"),w(""),k(""),N("");else{const s=await r.json();t(s.message||"Failed to change password")}}catch{t("Failed to change password")}finally{o(!1),setTimeout(()=>t(""),3e3)}};return e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-light-pink dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:c==="admin"?"Merchant Profile / Settings":"User Profile / Settings"}),v&&e.jsx("div",{className:"bg-blue-100 text-blue-800 p-3 rounded-md mb-4",children:v}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8",children:[e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Edit Profile"}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),e.jsx("input",{type:"text",id:"name",name:"name",value:m.name,onChange:p,className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:m.email,onChange:p,className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",name:"phone",value:m.phone,onChange:p,className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:n,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:n?"Saving...":"Save Profile"})]})]}),e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"Change Password"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Current Password"}),e.jsx("input",{type:"password",id:"currentPassword",value:f,onChange:a=>w(a.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"New Password"}),e.jsx("input",{type:"password",id:"newPassword",value:u,onChange:a=>k(a.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmNewPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm New Password"}),e.jsx("input",{type:"password",id:"confirmNewPassword",value:j,onChange:a=>N(a.target.value),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:n,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:n?"Changing...":"Change Password"})]})]}),c==="admin"&&e.jsxs("div",{className:"bg-light-pink-100 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow-md col-span-full",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold mb-4",children:"User Management"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:"Manage employees like pickup staff, managers, and other team members."}),e.jsxs("div",{className:"mb-4",children:[e.jsx("button",{onClick:()=>h(!P),className:"px-4 py-2 rounded-md bg-green-500 text-white hover:bg-green-600 mr-2",children:"Add User"}),e.jsx("button",{onClick:()=>T(!C),className:"px-4 py-2 rounded-md bg-yellow-500 text-white hover:bg-yellow-600 mr-2",children:"Manage Roles"})]}),P&&e.jsxs("div",{className:"mb-6 p-4 border border-gray-300 dark:border-gray-600 rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Add New User"}),e.jsxs("form",{onSubmit:E,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Username"}),e.jsx("input",{type:"text",value:d.username,onChange:a=>i({...d,username:a.target.value}),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",value:d.email,onChange:a=>i({...d,email:a.target.value}),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone"}),e.jsx("input",{type:"tel",value:d.phone,onChange:a=>i({...d,phone:a.target.value}),className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Role"}),e.jsx("input",{type:"text",value:d.role,onChange:a=>i({...d,role:a.target.value}),placeholder:"e.g., Pickup Staff, Manager, Delivery Boy",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Password"}),e.jsx("input",{type:"password",value:d.password,onChange:a=>i({...d,password:a.target.value}),placeholder:"Set password for this user",className:"mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",required:!0})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("button",{type:"submit",disabled:n,className:"px-4 py-2 rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50 mr-2",children:n?"Adding...":"Add User"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 rounded-md bg-gray-500 text-white hover:bg-gray-600",children:"Cancel"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:U.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:a.username}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:a.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:C?e.jsx("input",{type:"text",value:a.role||"",onChange:r=>S(a.user_id,r.target.value),onBlur:r=>S(a.user_id,r.target.value),className:"p-1 border border-gray-300 dark:border-gray-600 rounded bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter role name"}):e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.role==="admin"?"bg-purple-100 text-purple-800":a.role==="manager"?"bg-blue-100 text-blue-800":a.role==="pickup"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.role||"employee"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:a.role!=="admin"&&e.jsx("button",{onClick:()=>R(a.user_id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200",children:"Remove"})})]},a.user_id))})]})})]})]})]})}export{J as default};
