import{r as o,a as L,u as A,j as e}from"./index-Cmzhr2PI.js";import{F as T}from"./FileUpload-C0_H3aEp.js";import{D as R,u as p,w as U,E as V,a as E}from"./jspdf.plugin.autotable-D5Z2eyjb.js";import{f as b}from"./currency-DGtur7pf.js";function B(){const[w,f]=o.useState([]),[h,j]=o.useState(!0),[y,k]=o.useState(""),[x,v]=o.useState("all"),[N,m]=o.useState(!1),[d,c]=o.useState({orderId:"",dueDate:"",status:"pending"}),{user:u}=L();A();const D=(u==null?void 0:u.role)||"admin";o.useEffect(()=>{g()},[]);const g=async()=>{try{const t=await fetch("/api/invoices",{credentials:"include"});if(t.ok){const s=await t.json();f(s.invoices||[])}}catch(t){console.error("Failed to load invoices:",t)}finally{j(!1)}},S=async t=>{const s=new FormData;s.append("file",t);try{const l=await fetch("/api/invoices/upload-csv",{method:"POST",credentials:"include",body:s}),a=await l.json();l.ok?(alert(`${a.message}

Created: ${a.created} invoices`),g()):alert(`Upload failed: ${a.message}`)}catch{alert("Upload failed: Network error")}},I=async()=>{try{const t=await fetch("/api/invoices/add-manual",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d)});if(t.ok)alert("Invoice created successfully!"),m(!1),c({orderId:"",dueDate:"",status:"pending"}),g();else{const s=await t.json();alert(`Failed to create invoice: ${s.message||"Unknown error"}`)}}catch{alert("Failed to create invoice: Network error")}},C=()=>{const t=["Invoice ID","Order ID","Customer Name","Amount","Status","Due Date","Created Date"],s=i.map(n=>[`INV${n.invoice_id}`,`ORD${n.order_id}`,n.customer_name,n.total_amount,n.status,n.due_date,new Date(n.created_at).toLocaleDateString()]),l=[t,...s].map(n=>n.map(F=>`"${F}"`).join(",")).join(`
`),a=new Blob([l],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),$=URL.createObjectURL(a);r.setAttribute("href",$),r.setAttribute("download",`invoices_${new Date().toISOString().split("T")[0]}.csv`),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)},_=()=>{const t=["Invoice ID","Order ID","Customer Name","Amount","Status","Due Date","Created Date"],s=i.map(r=>[`INV${r.invoice_id}`,`ORD${r.order_id}`,r.customer_name,r.total_amount,r.status,r.due_date,new Date(r.created_at).toLocaleDateString()]),l=p.aoa_to_sheet([t,...s]),a=p.book_new();p.book_append_sheet(a,l,"Invoices"),U(a,`invoices_${new Date().toISOString().split("T")[0]}.xlsx`)},O=()=>{const t=new V;t.setFontSize(16),t.text("Invoices Report",14,15),t.setFontSize(10),t.text(`Generated on: ${new Date().toLocaleDateString()}`,14,25);const s=[["Invoice ID","Order ID","Customer Name","Amount","Status","Due Date","Created Date"]],l=i.map(a=>[`INV${a.invoice_id}`,`ORD${a.order_id}`,a.customer_name,b(a.total_amount),a.status,a.due_date,new Date(a.created_at).toLocaleDateString()]);E(t,{head:s,body:l,startY:35,styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),t.save(`invoices_${new Date().toISOString().split("T")[0]}.pdf`)},i=w.filter(t=>t.customer_name.toLowerCase().includes(y.toLowerCase())&&(x==="all"||t.status===x));return h?e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"Invoice Management"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading invoices..."})})]}):e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 bg-light-pink dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"Invoice Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0",children:[e.jsx("input",{type:"text",placeholder:"Search by customer name...",value:y,onChange:t=>k(t.target.value),className:"w-full sm:w-1/3 p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white"}),e.jsxs("select",{value:x,onChange:t=>v(t.target.value),className:"w-full sm:w-1/4 p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),D==="admin"&&e.jsxs("div",{className:"mb-6",children:[e.jsx(T,{onFileUpload:S}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"CSV Upload Format:"}),e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300 mb-2",children:"Your CSV file should include these columns:"}),e.jsx("div",{className:"text-xs font-mono bg-white dark:bg-gray-800 p-2 rounded border overflow-x-auto",children:e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"order_id, due_date, status"})}),e.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 mt-2",children:[e.jsx("strong",{children:"Example:"})," 1, 2024-02-15, pending"]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("button",{onClick:()=>m(!0),className:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors w-full",children:"Create Invoice Manually"}),e.jsx(R,{onDownloadCSV:C,onDownloadExcel:_,onDownloadPDF:O})]})]}),e.jsx("div",{className:"overflow-x-auto bg-light-pink-100 dark:bg-gray-800 rounded-lg shadow mb-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Invoice ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Due Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Created"})]})}),e.jsx("tbody",{className:"bg-light-pink-100 dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500 dark:text-gray-400",children:h?"Loading invoices...":"No invoices found. Create invoices from orders or upload CSV data."})}):i.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["INV",t.invoice_id]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["ORD",t.order_id]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:b(t.total_amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.status==="paid"?"bg-green-100 text-green-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.due_date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:new Date(t.created_at).toLocaleDateString()})]},t.invoice_id))})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Create New Invoice"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Order ID",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.orderId,onChange:t=>c({...d,orderId:t.target.value})}),e.jsx("input",{type:"date",placeholder:"Due Date",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.dueDate,onChange:t=>c({...d,dueDate:t.target.value})}),e.jsxs("select",{className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:d.status,onChange:t=>c({...d,status:t.target.value}),children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx("button",{onClick:()=>m(!1),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:!d.orderId||!d.dueDate,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:"Create Invoice"})]})]})})]})}export{B as default};
