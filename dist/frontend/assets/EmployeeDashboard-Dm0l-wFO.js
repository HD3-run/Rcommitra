import{a as w,r as d,j as e}from"./index-Cmzhr2PI.js";function v(){const{user:n}=w(),[h,c]=d.useState([]),[y,b]=d.useState(!0),[x,l]=d.useState(null),[p,f]=d.useState(null),[g]=d.useState(!1),[o,j]=d.useState({totalAssigned:0,completed:0,pending:0,inProgress:0});d.useEffect(()=>{i(),g&&u()},[]);const u=async()=>{try{const t=await fetch("/api/orders/debug",{credentials:"include"});if(t.ok){const s=await t.json();f(s)}}catch(t){console.error("Debug info load failed:",t)}},i=async()=>{try{l(null),console.log("Loading assigned orders for employee dashboard");const t=await fetch("/api/orders",{credentials:"include"});if(console.log("Employee dashboard API response:",{status:t.status,ok:t.ok,headers:Object.fromEntries(t.headers.entries())}),!t.ok){const r=await t.text();throw console.error("API Error:",t.status,r),l(`API Error: ${t.status} - ${r}`),new Error(`API Error: ${t.status} - ${r}`)}const s=await t.json();if(console.log("Employee dashboard data:",s),s.orders&&Array.isArray(s.orders)){const r=s.orders.map(a=>({order_id:a.order_id.toString(),order_number:`ORD${a.order_id}`,customer_name:a.customer_name||"Unknown",customer_phone:a.customer_phone||"N/A",delivery_address:a.customer_address||a.customer_email||"N/A",total_amount:parseFloat(a.total_amount)||0,status:a.status||"pending",assigned_at:a.created_at||new Date().toISOString()}));c(r),m(r)}else console.warn("No orders array in response:",s),c([]),m([]),s.debug&&console.log("Debug info from API:",s.debug)}catch(t){console.error("Failed to load assigned orders:",t),l(t instanceof Error?t.message:"Failed to load orders"),c([]),m([])}finally{b(!1)}},m=t=>{const s={totalAssigned:t.length,completed:t.filter(r=>r.status==="delivered").length,pending:t.filter(r=>r.status==="pending").length,inProgress:t.filter(r=>r.status==="shipped").length};j(s)},N=async(t,s)=>{try{(await fetch(`/api/employee/orders/${t}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:s})})).ok&&i()}catch{console.error("Failed to update order status")}};return y?e.jsx("div",{className:"p-8 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your assigned orders..."})]})}):e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[g&&p&&e.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-900 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-bold",children:"Debug Information"}),e.jsx("button",{onClick:u,className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"Refresh Debug Info"})]}),e.jsx("pre",{className:"text-xs bg-white dark:bg-gray-800 p-2 rounded overflow-auto max-h-40",children:JSON.stringify(p,null,2)})]}),x&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"font-bold",children:"Error Loading Orders:"}),e.jsx("span",{className:"block sm:inline ml-2",children:x})]}),e.jsx("button",{onClick:()=>{l(null),i()},className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Retry"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl font-bold",children:["Welcome, ",n==null?void 0:n.username]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Role: ",n==null?void 0:n.role]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Total Assigned"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:o.totalAssigned})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600",children:o.pending})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"In Progress"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:o.inProgress})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Completed"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:o.completed})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Current Assigned Orders"})}),h.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsxs("div",{className:"text-gray-500 dark:text-gray-400 mb-4",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Orders Assigned"}),e.jsx("p",{className:"text-sm mb-4",children:x?"There was an error loading your orders.":"No orders have been assigned to you yet."}),e.jsx("button",{onClick:i,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors",children:"Refresh Orders"})]}),g&&e.jsxs("div",{className:"mt-4 text-left bg-gray-100 dark:bg-gray-800 p-4 rounded",children:[e.jsx("h4",{className:"font-bold mb-2",children:"Troubleshooting:"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"• Check if you are logged in as the correct user"}),e.jsx("li",{children:"• Verify that orders have been assigned to your account"}),e.jsx("li",{children:"• Contact your administrator if the problem persists"})]})]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order #"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.order_number}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customer_phone}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs truncate",children:t.delivery_address}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["₹",t.total_amount]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.status==="delivered"?"bg-green-100 text-green-800":t.status==="shipped"?"bg-blue-100 text-blue-800":t.status==="confirmed"?"bg-purple-100 text-purple-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("select",{value:t.status,onChange:s=>N(t.order_id,s.target.value),className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]},t.order_id))})]})})]})]})}export{v as default};
