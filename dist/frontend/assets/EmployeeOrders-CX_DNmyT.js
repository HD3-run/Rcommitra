import{r as o,j as e}from"./index-Cmzhr2PI.js";function w(){const[h,n]=o.useState([]),[g,u]=o.useState(!0),[c,i]=o.useState(null),[d,y]=o.useState("all"),[l,b]=o.useState("");o.useEffect(()=>{x()},[]);const x=async()=>{try{i(null),console.log("Loading orders for employee orders page");const t=await fetch("/api/orders",{credentials:"include"});if(console.log("Employee orders API response:",{status:t.status,ok:t.ok,headers:Object.fromEntries(t.headers.entries())}),!t.ok){const a=await t.text();console.error("API Error in EmployeeOrders:",t.status,a),i(`Failed to load orders: ${t.status} - ${a}`),n([]);return}const r=await t.json();if(console.log("Employee orders data:",r),r.orders&&Array.isArray(r.orders)){const a=r.orders.map(s=>({id:s.order_id.toString(),orderId:`ORD${s.order_id}`,customerName:s.customer_name||"Unknown",amount:parseFloat(s.total_amount)||0,status:s.status||"pending",date:new Date(s.order_date||s.created_at).toISOString().split("T")[0],channel:s.order_source||"Unknown",type:"Standard",customer:s.customer_name||"Unknown"}));n(a),console.log("Formatted orders for employee:",a.length)}else console.warn("No orders array in employee orders response:",r),n([]),r.debug&&console.log("Debug info from employee orders API:",r.debug)}catch(t){console.error("Failed to load employee orders:",t),i(t instanceof Error?t.message:"Failed to load orders"),n([])}finally{u(!1)}},f=async(t,r)=>{try{(await fetch(`/api/employee/orders/${t}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:r})})).ok?n(s=>s.map(p=>p.id===t?{...p,status:r}:p)):alert("Failed to update order status")}catch{alert("Failed to update order status")}},m=h.filter(t=>{const r=t.customerName.toLowerCase().includes(l.toLowerCase())||t.orderId.toLowerCase().includes(l.toLowerCase()),a=d==="all"||t.status===d;return r&&a});return g?e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"My Orders"}),e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Loading your orders..."})]})})]}):e.jsxs("div",{className:"p-4 sm:p-6 md:p-8 min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold mb-6",children:"My Orders"}),c&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{className:"font-bold",children:"Error Loading Orders:"}),e.jsx("span",{className:"block sm:inline ml-2",children:c})]}),e.jsx("button",{onClick:()=>{i(null),x()},className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Retry"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search by customer or order ID...",className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md w-full sm:w-auto bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:l,onChange:t=>b(t.target.value)}),e.jsxs("select",{className:"p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:d,onChange:t=>y(t.target.value),children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Order ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Customer Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Channel"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-12 text-center",children:e.jsxs("div",{className:"text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:l||d!=="all"?"No Matching Orders":"No Orders Assigned"}),e.jsx("p",{className:"text-sm mb-4",children:l||d!=="all"?"Try adjusting your search or filter criteria.":c?"There was an error loading your orders.":"No orders have been assigned to you yet. Contact your admin to assign orders."}),!l&&d==="all"&&e.jsx("button",{onClick:x,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition-colors",children:"Refresh Orders"})]})})}):m.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:t.orderId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.customerName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.channel}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.status==="delivered"?"bg-green-100 text-green-800":t.status==="shipped"?"bg-blue-100 text-blue-800":t.status==="confirmed"?"bg-purple-100 text-purple-800":t.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:["$",t.amount.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300",children:t.date}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("select",{value:t.status,onChange:r=>f(t.id,r.target.value),className:"text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"confirmed",children:"Confirmed"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]},t.id))})]})})]})}export{w as default};
